<!DOCTYPE html>
<html lang="en">
    <head>
        <title> Currency Converter </title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
        <meta name="description" content="Admin template that can be used to build dashboards for CRM, CMS, etc." />
        <meta name="author" content="Potenza Global Solutions" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <!-- app favicon -->
        <link rel="shortcut icon" href="assets/img/favicon.png">
        <!-- google fonts -->
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
        <!-- plugin stylesheets -->
        <link rel="stylesheet" type="text/css" href="assets/css/vendors.css" />
        <!-- app style -->
        <link rel="stylesheet" type="text/css" href="assets/css/style.css" />
    </head>
    <body>
        <!-- begin app -->
        <div class="app">
            <!-- begin app-wrap -->
            <div class="app-wrap">
                <!-- begin app-header -->
                <header class="app-header top-bar">
                    <!-- begin navbar -->
                    <nav class="navbar navbar-expand-md">
                        <!-- begin navbar-header -->
                        <div class="navbar-header d-flex align-items-center">
                            <a href="javascript:void:(0)" class="mobile-toggle"><i class="ti ti-align-right"></i></a>
                            <a class="navbar-brand" href="index.html">
                                <img src="assets/img/logo.png" class="img-fluid logo-desktop" alt="logo" />
                                <img src="assets/img/logo-icon.png" class="img-fluid logo-mobile" alt="logo" />
                            </a>
                        </div>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <i class="ti ti-align-left"></i>
                        </button>
                        <!-- end navbar-header -->

                        <!-- begin navigation -->
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <div class="navigation d-flex">
                                <ul class="navbar-nav nav-left">
                                    <li class="nav-item">
                                        <a href="javascript:void(0)" class="nav-link sidebar-toggle">
                                            <i class="ti ti-align-right"></i>
                                        </a>
                                    </li>
                                    <li class="nav-item full-screen d-none d-lg-block" id="btnFullscreen">
                                        <a href="javascript:void(0)" class="nav-link expand">
                                            <i class="icon-size-fullscreen"></i>
                                        </a>
                                    </li>
                                </ul>
                                <ul class="navbar-nav nav-right ml-auto">
                                </ul>
                            </div>
                        </div>
                        <!-- end navigation -->
                    </nav>
                    <!-- end navbar -->
                </header>
                <!-- end app-header -->

                <!-- begin app-container -->
                <div class="app-container">
                    <!-- begin app-nabar -->
                    <aside class="app-navbar">
                        <!-- begin sidebar-nav -->
                        <div class="sidebar-nav scrollbar scroll_light">
                            <ul class="metismenu " id="sidebarNav">
                                &nbsp;&nbsp;&nbsp;
                                &nbsp;&nbsp;&nbsp;
                                <li class="">
                                     <a href='index.html'>Overview</a> 
                                </li>
                                <li class="">
                                     <a href='stock.html'>Stocks List</a> 
                                </li>
                                <li class="active">
                                     <a href='converter.html'>Currency Converter</a> 
                                </li>
                                &nbsp;&nbsp;&nbsp;
                                <li class="sidebar-banner p-4 bg-gradient text-center m-3 d-block rounded">
                                    <h5 class="text-white mb-1">SM Trackr</h5>
                                    <p class="font-13 text-white line-20">Stock Tracker and Currency Converter Dashboard</p>
                                    <a class="btn btn-square btn-inverse-light btn-xs d-inline-block mt-2 mb-0" href="#"> Tracking Partner</a>
                                </li>  
                            </ul>
                        </div>
                        <!-- end sidebar-nav -->
                    </aside>
                    <!-- end app-navbar -->
                    <!-- begin app-main -->
                    <div class="app-main" id="main">
                        <!-- begin container-fluid -->
                        <div class="container-fluid">
                            <!-- begin row -->
                            <div class="row">
                                <div class="col-md-12 m-b-30">
                                    <!-- begin page title -->
                                    <div class="d-block d-sm-flex flex-nowrap align-items-center">
                                        <div class="page-title mb-2 mb-sm-0">
                                            <h1>Currency Converter Dashboard</h1>
                                        </div>
                                    </div>
                                    <!-- end page title -->
                                </div>
                            </div>
                            <!-- end row -->
                            <!-- start Crypto Currency contant -->
                            <div class="row crypto-currency">
                                <div class="col-12">
                                    <div class="card card-statistics p-0 owl-wrapper">
                                        <div class="row align-items-center no-gutters">
                                            <div class="col-xs-11 text-center text-xxl-left bg-primary px-3 py-3" style="text-align: center;">
                                                <span class="text-white">Exchange Rate Monitor and Currency Converter Dashboard</span>
                                                <span class="badge badge-light-inverse ml-xxl-4">USD Pair</span>
                                            </div>
                                            <div class="col-xs-1 py-3 py-xs-0">
                                               
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card card-statistics">
                                        <div class="card-header">
                                            <div class="card-heading">
                                                <h4 class="card-title" style="text-align: center;">Currency Converter</h4>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="card card-statistics mail-contant">
                                                    <div class="card-body p-0">
                                                        <div class="row no-gutters">
                                                            <div class="col-md-3 col-xxl-2 col-md-3">
                                                                <div class="mail-sidebar">
                                                                    <div class="row justify-content-center">
                                                                        <div class="col-12">
                                                                            <div class="text-center mail-sidebar-title px-4">
                                                                                Source Currency<i class="fa fa-money pl-2"></i>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-12">
                                                                            <div class="px-4 py-4">
                                                                                <div class="card card-statistics h-100 mb-0 o-hidden">
                                                                                    <div class="card-header d-flex justify-content-between">
                                                                                        <div class="dropdown">
                                                                                            <select id="sourceCurrency"></select> 
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3 col-xxl-2 col-md-3">
                                                                <div class="mail-sidebar">
                                                                    <div class="row justify-content-center">
                                                                        <div class="col-12">
                                                                            <div class="text-center mail-sidebar-title px-4">
                                                                                Amount <i class="fa fa-money pl-2"></i>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-12">
                                                                            <div class="px-4 py-4">
                                                                                <form>
                                                                                    <div class="form-group">
                                                                                        <input type="Number" class="form-control" id="amount" min="0" step="0.01" placeholder="Enter Amount">
                                                                                    </div>
                                                                                </form>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3 col-xxl-2 col-md-3">
                                                                <div class="mail-sidebar">
                                                                    <div class="row justify-content-center">
                                                                        <div class="col-12">
                                                                            <div class="text-center mail-sidebar-title px-4">
                                                                                Target Currency <i class="fa fa-money pl-2"></i>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-12">
                                                                            <div class="px-4 py-4">
                                                                                <div class="card card-statistics h-100 mb-0 o-hidden">
                                                                                    <div class="card-header d-flex justify-content-between">
                                                                                        <div class="dropdown">
                                                                                            <select id="destinationCurrency"></select>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3 col-xxl-2 col-md-3">
                                                                <div class="mail-sidebar">
                                                                    <div class="row justify-content-center">
                                                                        <div class="col-12">
                                                                            <div class="px-4 py-4" style="text-align: center; margin-top: 30px;">
                                                                                <button onclick="convertCurrency()" class="btn btn-primary">Convert</button>
                                                                                
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3 col-xxl-2 col-md-3">
                                                                <div class="mail-sidebar">
                                                                    <div class="row justify-content-center">
                                                                        <div class="col-12">
                                                                            <div class="text-center mail-sidebar-title px-4">
                                                                                 Amount<i class="fa fa-money pl-2"></i>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-12">
                                                                            <div class="px-4 py-4">
                                                                                <div class="card card-statistics h-100 m-b-0">
                                                                                    <div class="card-header bg-gradient">
                                                                                            <div class="row align-items-center" style="justify-content:center;">
                                                                                            <p id="convertedAmount" style="color: white;"></p>
                                                                                        </div>
                                                                                    </div> 
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xxl-4 m-b-30">
                                    <div class="card card-statistics h-100 mb-0">
                                        <div class="card-header d-flex align-items-center justify-content-between">
                                            <div class="card-heading">
                                                <h4 class="card-title">Live USD Currency Pairs Table</h4>
                                            </div>
                                        </div>
                                        <div class="card-body scrollbar scroll_dark pt-0" style="max-height: 350px;">
                                            <div class="datatable-wrapper table-responsive">
                                                <table id="export-table" class="table table-bordered">
                                                    <thead class="thead-light">
                                                        <tr>
                                                            <th>Currency Pair</th>
                                                            <th>Exchange Rate</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="exchangeRateTable">
                                                        
                                                    </tbody>
                                                    <tfoot>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Currency Pair</th>
                                                            <th>Exchange Rate</th>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xxl-8 m-b-30">
                                    <div class="card card-statistics">
                                        <div class="card-header">
                                            <div class="card-heading">
                                                <h4 class="card-title">USD Currency Pairs Exchange Rates</h4>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div>
                                                <label for="currencyPairSelect">Select up to 15 Currency Pairs: </label>
                                                <select id="currencyPairSelect" multiple style="width: 300px;">
                                                  <!-- Add options dynamically through JavaScript -->
                                                </select>
                                                <button onclick="updateChart()">Update Chart</button>
                                            </div>
                                            <div style="width: 600px;">
                                                <canvas id="exchangeRateChart" width="600" height="300"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>     
                    </div>
                    <!-- end container-fluid -->
                </div>
                <!-- end app-main -->
            </div>
            <!-- end app-container -->
            <!-- begin footer -->
            <footer class="footer">
                <div class="row">
                    <div class="col  col-sm-6 ml-sm-auto text-center text-sm-right">
                        <p>&copy; 2023. All rights reserved.</p>
                    </div> 
                </div>
            </footer>
            <!-- end footer -->
        </div>
        <!-- end app -->

        <!-- plugins -->
        <script src="assets/js/vendors.js"></script>
        <!-- custom app -->
        <script src="assets/js/app.js"></script> 

        <script>
            // Global variables for API key and base currency
            const apiKey = '8243f384c2b725d15982f7e5';
            const baseCurrency = 'USD';
            let chart;

            // Function to fetch the currency rates
            async function fetchCurrencyRates() {
              const apiUrl = `https://v6.exchangerate-api.com/v6/${apiKey}/latest/${baseCurrency}`;
              try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                if (data.result === 'success') {
                  return data.conversion_rates;
                } else {
                  console.error('API Error:', data['error-type']);
                }
              } catch (error) {
                console.error('Fetch Error:', error);
              }
            }

            // Function to initialize the currency dropdowns
            async function initCurrencyDropdowns(currencyRates) {
              const currencyCodes = Object.keys(currencyRates);
              const sourceCurrencySelect = document.getElementById('sourceCurrency');
              const destinationCurrencySelect = document.getElementById('destinationCurrency');
              for (const currencyCode of currencyCodes) {
                const option = document.createElement('option');
                option.value = currencyCode;
                option.textContent = currencyCode.toUpperCase();
                sourceCurrencySelect.appendChild(option);
                destinationCurrencySelect.appendChild(option.cloneNode(true));
              }

              // Fill the dropdown menu with currency options for the chart
              const currencyPairSelect = document.getElementById('currencyPairSelect');
              for (const currency of currencyCodes) {
                const option = document.createElement('option');
                option.value = currency;
                option.textContent = currency.toUpperCase();
                currencyPairSelect.appendChild(option);
              }

              // Get the default selected currency pairs for the chart
              const defaultSelectedCurrencies = ['eur', 'gbp', 'jpy', 'aud', 'cad', 'chf', 'cny', 'sek', 'nzd', 'mxn', 'sgd', 'hkd', 'nok', 'krw', 'try'];
              currencyPairSelect.value = defaultSelectedCurrencies;

              // Update the chart on DOM load
              updateChart();
            }

            // Function to convert currency
            function convertCurrency() {
              const sourceCurrency = document.getElementById('sourceCurrency').value;
              const destinationCurrency = document.getElementById('destinationCurrency').value;
              const amount = parseFloat(document.getElementById('amount').value);

              if (!isNaN(amount)) {
                fetchCurrencyRates().then(currencyRates => {
                  if (sourceCurrency === baseCurrency) {
                    const convertedAmount = amount * currencyRates[destinationCurrency];
                    document.getElementById('convertedAmount').textContent = `${amount} ${sourceCurrency.toUpperCase()} = ${convertedAmount.toFixed(2)} ${destinationCurrency.toUpperCase()}`;
                  } else if (destinationCurrency === baseCurrency) {
                    const convertedAmount = amount / currencyRates[sourceCurrency];
                    document.getElementById('convertedAmount').textContent = `${amount} ${sourceCurrency.toUpperCase()} = ${convertedAmount.toFixed(2)} ${destinationCurrency.toUpperCase()}`;
                  } else {
                    const convertedAmount = (amount / currencyRates[sourceCurrency]) * currencyRates[destinationCurrency];
                    document.getElementById('convertedAmount').textContent = `${amount} ${sourceCurrency.toUpperCase()} = ${convertedAmount.toFixed(2)} ${destinationCurrency.toUpperCase()}`;
                  }
                });
              } else {
                alert('Please enter a valid amount.');
              }
            }

            // Function to generate random colors for the bars
            function generateRandomColors(count) {
              const colors = [];
              for (let i = 0; i < count; i++) {
                const color = `rgba(${getRandomNumber(0, 255)}, ${getRandomNumber(0, 255)}, ${getRandomNumber(0, 255)}, 0.7)`;
                colors.push(color);
              }
              return colors;
            }

            // Function to get a random number within a range
            function getRandomNumber(min, max) {
              return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            // Function to update the chart with selected currencies
            function updateChart() {
              const selectedCurrencies = Array.from(document.getElementById('currencyPairSelect').selectedOptions, option => option.value);
              fetchCurrencyRates().then(currencyRates => {
                // Get the selected currency pairs and their exchange rates
                const labels = selectedCurrencies.map(currency => currency.toUpperCase());
                const exchangeRates = selectedCurrencies.map(currency => currencyRates[currency]);

                // Create the chart or update the existing one
                const ctx = document.getElementById('exchangeRateChart').getContext('2d');
                if (chart) {
                  chart.data.labels = labels;
                  chart.data.datasets[0].data = exchangeRates;
                  chart.data.datasets[0].backgroundColor = generateRandomColors(selectedCurrencies.length);
                  chart.update();
                } else {
                  const colors = generateRandomColors(labels.length);
                  chart = new Chart(ctx, {
                    type: 'bar', // Use a bar chart
                    data: {
                      labels: labels,
                      datasets: [{
                        label: 'Exchange Rates',
                        data: exchangeRates,
                        backgroundColor: colors,
                        borderWidth: 1,
                      }]
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      scales: {
                        y: {
                          beginAtZero: true
                        }
                      },
                      plugins: {
                        legend: {
                          display: false,
                        }
                      }
                    }
                  });
                }
              });
            }

            // Call the function to initialize the currency dropdowns and update the chart on DOM load
            document.addEventListener('DOMContentLoaded', () => {
              fetchCurrencyRates().then(currencyRates => {
                initCurrencyDropdowns(currencyRates);
              });
            });
        </script>

        <script>
            // Function to fetch and update the table
            async function updateTable() {
              const apiKey = '8243f384c2b725d15982f7e5';
              const baseCurrency = 'USD';
              const apiUrl = `https://v6.exchangerate-api.com/v6/${apiKey}/latest/${baseCurrency}`;

              try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                if (data.result === 'success') {
                  const rates = data.conversion_rates;
                  const tableBody = document.getElementById('exchangeRateTable');

                  // Clear existing table data
                  tableBody.innerHTML = '';

                  // Loop through all currency pairs and add rows to the table
                  for (const currency in rates) {
                    const exchangeRate = rates[currency];
                    const row = document.createElement('tr');
                    const currencyPairCell = document.createElement('td');
                    const exchangeRateCell = document.createElement('td');

                    currencyPairCell.textContent = `USD/${currency}`;
                    exchangeRateCell.textContent = exchangeRate.toFixed(4);

                    row.appendChild(currencyPairCell);
                    row.appendChild(exchangeRateCell);
                    tableBody.appendChild(row);
                  }
                } else {
                  console.error('API Error:', data['error-type']);
                }
              } catch (error) {
                console.error('Fetch Error:', error);
              }
            }

            // Update the table every 100 seconds (adjust as needed)
            setInterval(updateTable, 100000);
            updateTable(); // Initial update
        </script>
    </body>
</html>